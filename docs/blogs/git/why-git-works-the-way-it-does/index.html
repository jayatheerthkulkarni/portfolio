<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0"
		/>
		<title>Git internals</title>

		<link rel="icon" type="image/x-icon" href="./logo.png" />

		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link
			rel="preconnect"
			href="https://fonts.gstatic.com"
			crossorigin
		/>
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
			rel="stylesheet"
		/>

		<style>
			:root {
				--font-main:
					"Inter", -apple-system,
					BlinkMacSystemFont, "Segoe UI", Roboto,
					sans-serif;
				--font-mono:
					"SFMono-Regular", "Menlo", "Monaco",
					"Consolas", monospace;

				--bg: #ffffff;
				--text: #111111;
				--text-secondary: #555555;
				--accent: #0066ff;
				--border: #eeeeee;
				--card-bg: #f9f9f9;
				--code-bg: #f1f3f5;
			}

			[data-theme="dark"] {
				--bg: #0d0d0d;
				--text: #f0f0f0;
				--text-secondary: #a0a0a0;
				--accent: #3b82f6;
				--border: #222222;
				--card-bg: #161616;
				--code-bg: #222429;
			}

			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
				transition:
					background 0.2s ease,
					color 0.2s ease;
			}

			body {
				font-family: var(--font-main);
				background-color: var(--bg);
				color: var(--text);
				line-height: 1.6;
				-webkit-font-smoothing: antialiased;
			}

			.container {
				max-width: 680px;
				margin: 0 auto;
				padding: 2rem 1.2rem;
			}

			/* Navigation */
			.nav {
				display: flex;
				justify-content: space-between;
				margin-bottom: 3rem;
			}

			.btn {
				background: var(--card-bg);
				border: 1px solid var(--border);
				width: 42px;
				height: 42px;
				border-radius: 10px;
				cursor: pointer;
				display: flex;
				align-items: center;
				justify-content: center;
				color: var(--text);
			}

			.btn:hover {
				border-color: var(--accent);
				transform: translateY(-1px);
			}

			.btn svg {
				width: 18px;
				height: 18px;
				fill: currentColor;
			}

			/* Hero Image */
			.hero-img {
				width: 100%;
				height: auto;
				aspect-ratio: 16 / 9;
				object-fit: cover;
				border-radius: 16px;
				margin-bottom: 3rem;
				border: 1px solid var(--border);
			}

			/* Content */
			.meta {
				font-size: 0.75rem;
				font-weight: 700;
				color: var(--accent);
				text-transform: uppercase;
				letter-spacing: 0.1em;
				margin-bottom: 0.75rem;
				display: block;
			}

			h1 {
				font-size: 2.8rem;
				font-weight: 800;
				letter-spacing: -0.04em;
				line-height: 1.1;
				margin-bottom: 2rem;
			}

			.intro {
				font-size: 1.2rem;
				color: var(--text-secondary);
				border-left: 3px solid var(--accent);
				padding-left: 1.25rem;
				margin-bottom: 3.5rem;
			}

			h2 {
				font-size: 1.5rem;
				font-weight: 700;
				margin: 3.5rem 0 1.25rem;
				letter-spacing: -0.02em;
			}

			p {
				margin-bottom: 1.5rem;
				font-size: 1.05rem;
			}

			.block {
				background: var(--card-bg);
				border: 1px solid var(--border);
				padding: 1.75rem;
				border-radius: 12px;
				margin-bottom: 2rem;
			}

			.block h3 {
				font-size: 1.1rem;
				margin-bottom: 0.75rem;
				color: var(--text);
			}

			code {
				font-family: var(--font-mono);
				background: var(--code-bg);
				padding: 0.2rem 0.4rem;
				border-radius: 4px;
				font-size: 0.9rem;
			}

			ul {
				margin-bottom: 1.5rem;
				padding-left: 1rem;
				list-style: square;
			}
			li {
				margin-bottom: 0.5rem;
				color: var(--text-secondary);
			}
			li strong {
				color: var(--text);
			}

			@media (max-width: 600px) {
				h1 {
					font-size: 2rem;
				}
				.container {
					padding: 1rem;
				}
			}
		</style>
	</head>
	<body>
		<div class="container">
			<nav class="nav">
				<button
					onclick="goBack()"
					class="btn"
					title="Back"
				>
					<svg viewBox="0 0 24 24">
						<path
							d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"
						/>
					</svg>
				</button>
				<button
					id="theme-toggle"
					class="btn"
					title="Theme"
				>
					<svg viewBox="0 0 24 24">
						<path
							d="M12,18C11.11,18 10.26,17.8 9.5,17.45C11.56,16.5 13,14.42 13,12C13,9.58 11.56,7.5 9.5,6.55C10.26,6.2 11.11,6 12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31L23.31,12L20,8.69Z"
						/>
					</svg>
				</button>
			</nav>

			<main>
				<div class="hero-wrap">
					<img
						src="./gitinternals.png"
						alt="Git Index Visualization"
						class="hero-img"
					/>
				</div>

				<span class="meta"
					>Git Internals &bull; Feb 21, 2024</span
				>
				<h1>
					The Git Index: The Binary Secret of the
					Staging Area
				</h1>

				<p class="intro">
					Most users think the "staging area" is a
					virtual concept or a temporary folder.
					It is actually a single,
					high-performance binary file located at
					<code>.git/index</code>.
				</p>

				<p>
					The index is the bridge between your
					working directory and the permanent
					commit history. It is the most important
					file in your repository because it
					determines exactly what the next commit
					will look like.
				</p>

				<h2>1. The Binary Header</h2>
				<div class="block">
					<h3>The First 12 Bytes</h3>
					<p>
						The index file starts with a
						rigid 12-byte header that Git
						uses to verify the file
						integrity before reading a
						single entry:
					</p>
					<ul>
						<li>
							<strong
								>Signature (4
								bytes):</strong
							>
							The ASCII string "DIRC"
							(stands for "Directory
							Cache").
						</li>
						<li>
							<strong
								>Version (4
								bytes):</strong
							>
							Usually version 2, 3, or
							4. Version 4 supports
							path compression.
						</li>
						<li>
							<strong
								>Entry Count (4
								bytes):</strong
							>
							The total number of
							tracked files in the
							repository.
						</li>
					</ul>
				</div>

				<h2>2. Anatomy of an Entry</h2>
				<p>
					For every file in your project, the
					index stores a massive amount of
					metadata. This is why
					<code>git status</code> is so fast: Git
					compares this metadata against your
					files' "stat" info from the OS. If the
					timestamps match, Git knows the file
					hasn't changed without even reading the
					content.
				</p>
				<div class="block">
					<h3>What is inside a 62-byte entry?</h3>
					<ul>
						<li>
							<strong
								>ctime /
								mtime:</strong
							>
							The last time the file
							metadata and data
							changed.
						</li>
						<li>
							<strong
								>Object
								Name:</strong
							>
							The 160-bit SHA-1 hash
							of the file content (the
							Blob).
						</li>
						<li>
							<strong
								>File
								Mode:</strong
							>
							Permissions (e.g.,
							100644 for a regular
							file).
						</li>
						<li>
							<strong
								>File
								Size:</strong
							>
							The size of the file in
							bytes.
						</li>
					</ul>
				</div>

				<h2>3. The Staging Workflow</h2>
				<p>
					When you run <code>git add</code>, two
					specific things happen:
				</p>
				<p>
					First: Git hashes the file and stores it
					as a "blob" in
					<code>.git/objects</code>.
				</p>
				<p>
					Second: Git updates the
					<code>.git/index</code> file. It inserts
					the new SHA-1 hash and the current file
					metadata into the binary entry for that
					path.
				</p>

				<h2>4. The Extension Area</h2>
				<p>
					Modern versions of Git add extra data to
					the end of the index to speed up massive
					repositories. This includes the
					<b>Tree Cache</b> (which helps Git build
					tree objects for commits instantly) and
					the <b>Untracked Cache</b> (which
					prevents Git from re-scanning folders
					that haven't changed).
				</p>

				<h2>5. Checksum Integrity</h2>
				<p>
					The very last 20 bytes of the index file
					contain a SHA-1 checksum of the entire
					file content. If you manually edit the
					index with a hex editor and don't update
					this checksum, Git will refuse to open
					the repository, protecting you from data
					corruption.
				</p>
			</main>
		</div>

		<script>
			// Back Button
			function goBack() {
				if (window.history.length > 1) {
					window.history.back();
				} else {
					window.location.href = "./index.html";
				}
			}

			// Theme Switcher
			const toggle = document.getElementById("theme-toggle");
			const root = document.documentElement;

			const saved =
				localStorage.getItem("blog-theme") || "light";
			root.setAttribute("data-theme", saved);

			toggle.addEventListener("click", () => {
				const current = root.getAttribute("data-theme");
				const next =
					current === "light" ? "dark" : "light";
				root.setAttribute("data-theme", next);
				localStorage.setItem("blog-theme", next);
			});
		</script>
	</body>
</html>
